<html><head>
    <link rel="stylesheet" type="text/css" href="mystyle.css">
    <style>
        #container {border: 1px solid #3407a5;}
        H1 {float: left;}
        .merchant,.amount ,.time{

            padding:20px;
            display:inline;

        }
        .button{
            background-color:#55A;
            border: 1px solid #229;
            width: 100px;
            float: right;
            font-size: 2em;
            color: white;
            text-align: center;
        }
        .receipt{

            border: 1px solid #b9ffae;
        }

        #receiptList {
            border: 1px solid #4e804d;
            clear: both;
        }
        .receipt {
            background-color: #eee;
            margin-bottom: 5px;
        }
        .tagValue{
            margin-left: 10px;
        }
    </style>
    <script data-require="jquery@*" data-semver="3.1.1" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js">
    </script>

    <script>
        // This is the idiomatic way to ensure that JQuery does not
        // execute until the page has loaded
        $(function(){
            const api = "";
        })

        $(document).on('click','.add-tag',function(){

            $(this).after("<input class='tag_input' style='height:20px;margin-left:10px;width:40px' type='text'></input>");

        });



        $(document).on('keypress','.tag_input',function(e){
            var tag = $(this).val();
            if(e.keyCode == 13)
            {//put
                $.ajax({
                    type: 'PUT',
                    url: '/tags/'+$(this).val(),
                    data: $(this).parent().parent().attr('id'),
                    success: function(data) {
                    },
                    contentType: "application/json",
                    dataType: 'json',
                });
                $(`<button class="tagValue">${tag}</button>`)
                    .appendTo($('.tagValueBox', $("#"+$(this).parent().parent().attr('id'))));
                $(this).remove();
            }

        });

        $(document).on('click','.tagValue',function(){

            $.ajax({
                type: 'PUT',
                url: '/tags/'+$(this).text(),
                data: $(this).parent().parent().attr('id'),

                success: function(data) {
                },
                contentType: "application/json",
                dataType: 'json',
            });
            $(this).remove();
        });

        $(document).ready(function(){


            $("#cancel-receipt").click(function(){
                $("#sbox").hide();
            });


            $("#add-receipt").click(function(){
                $("#sbox").show();
            });


            $("#cancel-receipt").click(function(){
                $("#sbox").hide();
            });
            $("#save-receipt").click(function(){
                //post
                $.ajax({
                    type: 'POST',
                    url: '/receipts',
                    data: JSON.stringify({"merchant":$("#merchant").val(),"amount":$("#amount").val()}),
                    success: function(data) {
                        var d = new Date();
                        var time = d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
                        $(`<div class="receipt" id="${data}"><div class="time">${time}</div> <div class="merchant">${$("#merchant").val()}</div>
                        <div class="amount">${$("#amount").val()}</div>
                        <div class="tagValueBox">

                        <button class="add-tag">Add +</button></div>`)
                            .appendTo($("#receiptList"));
                    },
                    error: function (jqXHR, exception) {
                        var msg = '';
                        if (jqXHR.status === 0) {
                            msg = 'Not connect.\n Verify Network.';
                        } else if (jqXHR.status == 404) {
                            msg = 'Requested page not found. [404]';
                        } else if (jqXHR.status == 500) {
                            msg = 'Internal Server Error [500].';
                        } else if (exception === 'parsererror') {
                            msg = 'Requested JSON parse failed.';
                        } else if (exception === 'timeout') {
                            msg = 'Time out error.';
                        } else if (exception === 'abort') {
                            msg = 'Ajax request aborted.';
                        } else {
                            msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        }
                        $('#error').html(msg);
                    },
                    contentType: "application/json",
                    dataType: 'json'
                });

            });
        });



    </script>
</head>

<body>
<div id="container">
    <h1>My receipts</h1>
    <div id="add-receipt" class="button">+</div>
    <div style="float:right;margin-right:10px;display:none;" id="sbox">
        <input style="height:28px" id="merchant" placeholder="name" type="text" name="bday"><input placeholder="amount" id="amount" style="height:30px;margin-left:10px" type="text"><button style="height:30px;margin-left:10px" id="cancel-receipt">
        cancel</button><button style="height:30px;margin-left:10px" id="save-receipt">submit</button><div id="error"></div>
    </div>
    <div id="receiptList">
        </div>


</div>





</body></html>